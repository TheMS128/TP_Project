@using CourseProject.DataBase.Enums
@model CourseProject.Models.TeacherViewModels.SubjectManageViewModel
@{ ViewData["Title"] = Model.SubjectTitle; }

<div class="d-flex justify-content-between align-items-center mb-4 mt-3">
    <div>
        <h2 class="mb-0">@Model.SubjectTitle</h2>
        <p class="text-muted small mb-0">Управление курсом</p>
    </div>
    <div>
        <a asp-action="ConfigureGroups" asp-route-subjectId="@Model.SubjectId" class="btn btn-outline-primary">
            <i class="bi bi-people"></i> Доступ групп (@Model.EnrolledGroups.Count)
        </a>
        <a asp-action="Index" class="btn btn-secondary">К списку курсов</a>
    </div>
</div>

<ul class="nav nav-tabs mb-3" id="courseTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="lectures-tab" data-bs-toggle="tab" data-bs-target="#lectures" type="button" role="tab">Лекции</button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="tests-tab" data-bs-toggle="tab" data-bs-target="#tests" type="button" role="tab">Тесты</button>
    </li>
</ul>

<div class="tab-content" id="courseTabContent">

    <div class="tab-pane fade show active" id="lectures" role="tabpanel">
        <div class="mb-3">
            <a asp-action="CreateLecture" asp-route-subjectId="@Model.SubjectId" class="btn btn-success btn-sm">
                <i class="bi bi-plus-lg"></i> Новая лекция
            </a>
        </div>

        <table class="table table-hover align-middle">
            <thead class="table-light">
            <tr>
                <th>Название</th>
                <th class="text-center">Статус</th>
                <th class="text-end">Действия</th>
            </tr>
            </thead>
            <tbody>
            @foreach (var lecture in Model.Lectures)
            {
            <tr>
                <td>@lecture.Title</td>
                <td class="text-center">
                    @if(lecture.Status == ContentStatus.Published) { <span class="badge bg-success">Опубликовано</span> }
                    else if(lecture.Status == ContentStatus.Hidden) { <span class="badge bg-secondary">Скрыто</span> }
                    else { <span class="badge bg-warning text-dark">Черновик</span> }
                </td>
                <td class="text-end">
                    <form asp-action="ChangeLectureState" method="post" class="d-inline">
                        <input type="hidden" name="lectureId" value="@lecture.Id" />

                        @if (lecture.Status == ContentStatus.Draft || lecture.Status == ContentStatus.Hidden)
                        {
                        <button type="submit" name="newStatus" value="@ContentStatus.Published" class="btn btn-sm btn-outline-success" title="Опубликовать">
                            <i class="bi bi-check-lg"></i>
                        </button>
                        }
                        @if (lecture.Status == ContentStatus.Published)
                        {
                        <button type="submit" name="newStatus" value="@ContentStatus.Hidden" class="btn btn-sm btn-outline-secondary" title="Скрыть">
                            <i class="bi bi-eye-slash"></i>
                        </button>
                        }
                    </form>

                    <a href="#" class="btn btn-sm btn-primary"><i class="bi bi-pencil"></i></a>
                    <button class="btn btn-sm btn-danger"><i class="bi bi-trash"></i></button>
                </td>
            </tr>
            }
            </tbody>
        </table>
    </div>

    <div class="tab-pane fade" id="tests" role="tabpanel">
        <p class="text-muted p-3">Функционал управления тестами реализуется аналогично лекциям.</p>
    </div>
</div>